(()=>{"use strict";var e={630:e=>{e.exports='html{cursor:default;-moz-tab-size:4;tab-size:4;-webkit-tap-highlight-color:transparent;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-break:break-word;font-family:"Segoe UI",sans-serif;background:#15202b;color:#fff;font-size:.9375rem;font-weight:400;line-height:1.5;user-select:none}a{background-color:transparent}button,input,select{font-family:inherit;font-size:100%;line-height:1.15}button::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:1px dotted ButtonText}*,::after,::before{box-sizing:border-box}::after,::before{text-decoration:inherit;vertical-align:inherit}body,button,input,select{margin:0}img,svg{vertical-align:middle}img{border-style:none}svg:not(:root){overflow:hidden}button{-webkit-appearance:button}button,input{overflow:visible}button,select{text-transform:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}[tabindex],a,button,input,select{-ms-touch-action:manipulation;touch-action:manipulation}[hidden]{display:none}[disabled]{cursor:not-allowed}body{padding:1%}@media (min-width:0px){:root{--sidebar-flex: 0 0 100%;--main-flex: 0 0 100%;--padding-horizontal: 0;--padding-vertical: 0.5%}}@media (min-width:768px){:root{--sidebar-flex: 0 0 32%;--main-flex: 0 0 68%;--padding-horizontal: 0.5%;--padding-vertical: 0}}@media (min-width:992px){:root{--sidebar-flex: 0 0 25%;--main-flex: 0 0 75%}}@media (min-width:1200px){:root{--sidebar-flex: 0 0 20%;--main-flex: 0 0 80%}}.outer-sidebar{flex:var(--sidebar-flex);padding-right:var(--padding-horizontal);padding-bottom:var(--padding-vertical)}.outer-sidebar .sidebar{display:flex;flex-direction:column;padding:10px 15px;border:1.5px solid #fff;border-radius:4px}.outer-sidebar .row{cursor:pointer}.outer-sidebar .row:hover{text-decoration:underline;color:#999}.outer-sidebar .row[data-removed=false]{color:#2ecc40}.outer-sidebar .row[data-removed=true],.svg-icon-x[data-svg-type=clear],.svg-icon-x[data-svg-type=del-icon]{color:#ff4136}h2,h3{font-weight:300}h2{font-size:1.875rem}h3{font-size:1.64rem}input{margin-top:5px;width:220px}button,input,select{display:block;background:0 0;box-shadow:none;border:1.5px solid #fff;color:inherit;border-radius:2px;padding:5px 15px;max-width:100%;min-width:max-content;outline:0}button:disabled,input:disabled,select:disabled{color:#999;border-color:#999}button,select{width:auto}button:enabled,select:enabled{cursor:pointer}input[type=file]{border:0;padding:0;border-radius:0}.svg-icon-x{margin-left:5px;height:1em;width:1em;cursor:pointer}.svg-icon-x[data-svg-type=del-icon]{margin-left:0;margin-right:5px}.svg-icon-x[data-svg-type=close]{color:#111;grid-column-start:3;grid-row-start:1;margin-left:auto}.btn-save{margin-top:10px;display:block}.icon{height:16px;width:16px;margin-right:5px}.icon:not(span){fill:#fff;stroke:#fff;-moz-context-properties:fill,stroke}span.icon{display:inline-block}.outer-main{flex:var(--main-flex);padding-left:var(--padding-horizontal);padding-top:var(--padding-vertical)}.main{padding:1.25rem 2.25rem;border:1.5px solid #fff;border-radius:4px}.container{display:flex;flex-direction:row;flex-wrap:wrap;width:100%;height:max-content}.outer-notification{position:absolute;top:0;left:0;width:100%;min-height:100%}.notification-string,.outer-notification{display:flex;justify-content:center;align-items:center}.inner-notification{display:grid;grid-template-columns:1fr auto 1fr;grid-template-rows:1fr auto 1fr;justify-items:center;width:375px;height:300px;max-height:90vh;max-width:90vw;background:#fff;border:#ddd solid 2px;border-radius:4px;padding:1em;margin-top:10vh}.notification-string{grid-area:2/2/3/3;text-align:center;color:#111}[data-blur=true]{filter:blur(4px)}'},703:e=>{e.exports=".shared-login-popup .vertical-horizontal-center{width:100%;height:100%;position:fixed;z-index:100000000;top:0;left:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.shared-login-popup .card{pointer-events:auto}"}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}(()=>{var e,t,o,r,i={},l=[],s=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function a(e,t){for(var n in t)e[n]=t[n];return e}function u(e){var t=e.parentNode;t&&t.removeChild(e)}function c(e,t,n){var o,r,i,l=arguments,s={};for(i in t)"key"==i?o=t[i]:"ref"==i?r=t[i]:s[i]=t[i];if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(l[i]);if(null!=n&&(s.children=n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===s[i]&&(s[i]=e.defaultProps[i]);return d(e,s,o,r,null)}function d(t,n,o,r,i){var l={type:t,props:n,key:o,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==i?++e.__v:i};return null!=e.vnode&&e.vnode(l),l}function p(e){return e.children}function _(e,t){this.props=e,this.context=t}function f(e,t){if(null==t)return e.__?f(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?f(e):null}function h(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return h(e)}}function m(n){(!n.__d&&(n.__d=!0)&&t.push(n)&&!g.__r++||r!==e.debounceRendering)&&((r=e.debounceRendering)||o)(g)}function g(){for(var e;g.__r=t.length;)e=t.sort((function(e,t){return e.__v.__b-t.__v.__b})),t=[],e.some((function(e){var t,n,o,r,i,l;e.__d&&(i=(r=(t=e).__v).__e,(l=t.__P)&&(n=[],(o=a({},r)).__v=r.__v+1,M(l,r,o,t.__n,void 0!==l.ownerSVGElement,null!=r.__h?[i]:null,n,null==i?f(r):i,r.__h),C(n,r),r.__e!=i&&h(r)))}))}function v(e,t,n,o,r,s,a,u,c,_){var h,m,g,v,w,k,x,S=o&&o.__k||l,C=S.length;for(n.__k=[],h=0;h<t.length;h++)if(null!=(v=n.__k[h]=null==(v=t[h])||"boolean"==typeof v?null:"string"==typeof v||"number"==typeof v?d(null,v,null,null,v):Array.isArray(v)?d(p,{children:v},null,null,null):v.__b>0?d(v.type,v.props,v.key,null,v.__v):v)){if(v.__=n,v.__b=n.__b+1,null===(g=S[h])||g&&v.key==g.key&&v.type===g.type)S[h]=void 0;else for(m=0;m<C;m++){if((g=S[m])&&v.key==g.key&&v.type===g.type){S[m]=void 0;break}g=null}M(e,v,g=g||i,r,s,a,u,c,_),w=v.__e,(m=v.ref)&&g.ref!=m&&(x||(x=[]),g.ref&&x.push(g.ref,null,v),x.push(m,v.__c||w,v)),null!=w?(null==k&&(k=w),"function"==typeof v.type&&null!=v.__k&&v.__k===g.__k?v.__d=c=b(v,c,e):c=y(e,v,g,S,w,c),_||"option"!==n.type?"function"==typeof n.type&&(n.__d=c):e.value=""):c&&g.__e==c&&c.parentNode!=e&&(c=f(g))}for(n.__e=k,h=C;h--;)null!=S[h]&&("function"==typeof n.type&&null!=S[h].__e&&S[h].__e==n.__d&&(n.__d=f(o,h+1)),O(S[h],S[h]));if(x)for(h=0;h<x.length;h++)V(x[h],x[++h],x[++h])}function b(e,t,n){var o,r;for(o=0;o<e.__k.length;o++)(r=e.__k[o])&&(r.__=e,t="function"==typeof r.type?b(r,t,n):y(n,r,r,e.__k,r.__e,t));return t}function y(e,t,n,o,r,i){var l,s,a;if(void 0!==t.__d)l=t.__d,t.__d=void 0;else if(null==n||r!=i||null==r.parentNode)e:if(null==i||i.parentNode!==e)e.appendChild(r),l=null;else{for(s=i,a=0;(s=s.nextSibling)&&a<o.length;a+=2)if(s==r)break e;e.insertBefore(r,i),l=i}return void 0!==l?l:r.nextSibling}function w(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||s.test(t)?n:n+"px"}function k(e,t,n,o,r){var i;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof o&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||w(e.style,t,"");if(n)for(t in n)o&&n[t]===o[t]||w(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])i=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?o||e.addEventListener(t,i?S:x,i):e.removeEventListener(t,i?S:x,i);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function x(t){this.l[t.type+!1](e.event?e.event(t):t)}function S(t){this.l[t.type+!0](e.event?e.event(t):t)}function M(t,n,o,r,i,l,s,u,c){var d,f,h,m,g,b,y,w,k,x,S,M=n.type;if(void 0!==n.constructor)return null;null!=o.__h&&(c=o.__h,u=n.__e=o.__e,n.__h=null,l=[u]),(d=e.__b)&&d(n);try{e:if("function"==typeof M){if(w=n.props,k=(d=M.contextType)&&r[d.__c],x=d?k?k.props.value:d.__:r,o.__c?y=(f=n.__c=o.__c).__=f.__E:("prototype"in M&&M.prototype.render?n.__c=f=new M(w,x):(n.__c=f=new _(w,x),f.constructor=M,f.render=P),k&&k.sub(f),f.props=w,f.state||(f.state={}),f.context=x,f.__n=r,h=f.__d=!0,f.__h=[]),null==f.__s&&(f.__s=f.state),null!=M.getDerivedStateFromProps&&(f.__s==f.state&&(f.__s=a({},f.__s)),a(f.__s,M.getDerivedStateFromProps(w,f.__s))),m=f.props,g=f.state,h)null==M.getDerivedStateFromProps&&null!=f.componentWillMount&&f.componentWillMount(),null!=f.componentDidMount&&f.__h.push(f.componentDidMount);else{if(null==M.getDerivedStateFromProps&&w!==m&&null!=f.componentWillReceiveProps&&f.componentWillReceiveProps(w,x),!f.__e&&null!=f.shouldComponentUpdate&&!1===f.shouldComponentUpdate(w,f.__s,x)||n.__v===o.__v){f.props=w,f.state=f.__s,n.__v!==o.__v&&(f.__d=!1),f.__v=n,n.__e=o.__e,n.__k=o.__k,f.__h.length&&s.push(f);break e}null!=f.componentWillUpdate&&f.componentWillUpdate(w,f.__s,x),null!=f.componentDidUpdate&&f.__h.push((function(){f.componentDidUpdate(m,g,b)}))}f.context=x,f.props=w,f.state=f.__s,(d=e.__r)&&d(n),f.__d=!1,f.__v=n,f.__P=t,d=f.render(f.props,f.state,f.context),f.state=f.__s,null!=f.getChildContext&&(r=a(a({},r),f.getChildContext())),h||null==f.getSnapshotBeforeUpdate||(b=f.getSnapshotBeforeUpdate(m,g)),S=null!=d&&d.type===p&&null==d.key?d.props.children:d,v(t,Array.isArray(S)?S:[S],n,o,r,i,l,s,u,c),f.base=n.__e,n.__h=null,f.__h.length&&s.push(f),y&&(f.__E=f.__=null),f.__e=!1}else null==l&&n.__v===o.__v?(n.__k=o.__k,n.__e=o.__e):n.__e=L(o.__e,n,o,r,i,l,s,c);(d=e.diffed)&&d(n)}catch(t){n.__v=null,(c||null!=l)&&(n.__e=u,n.__h=!!c,l[l.indexOf(u)]=null),e.__e(t,n,o)}}function C(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(e){e.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function L(e,t,n,o,r,s,a,c){var d,p,_,f,h,m=n.props,g=t.props,b=t.type;if("svg"===b&&(r=!0),null!=s)for(d=0;d<s.length;d++)if(null!=(p=s[d])&&(e==p||p.localName==b)){e=p,s[d]=null;break}if(null==e){if(null===b)return document.createTextNode(g);e=r?document.createElementNS("http://www.w3.org/2000/svg",b):document.createElement(b,g.is&&g),s=null,c=!1}if(null===b)m===g||c&&e.data===g||(e.data=g);else{if(null!=s&&(s=l.slice.call(e.childNodes)),_=(m=n.props||i).dangerouslySetInnerHTML,f=g.dangerouslySetInnerHTML,!c){if(null!=s)for(m={},h=0;h<e.attributes.length;h++)m[e.attributes[h].name]=e.attributes[h].value;(f||_)&&(f&&(_&&f.__html==_.__html||f.__html===e.innerHTML)||(e.innerHTML=f&&f.__html||""))}if(function(e,t,n,o,r){var i;for(i in n)"children"===i||"key"===i||i in t||k(e,i,null,n[i],o);for(i in t)r&&"function"!=typeof t[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===t[i]||k(e,i,t[i],n[i],o)}(e,g,m,r,c),f)t.__k=[];else if(d=t.props.children,v(e,Array.isArray(d)?d:[d],t,n,o,r&&"foreignObject"!==b,s,a,e.firstChild,c),null!=s)for(d=s.length;d--;)null!=s[d]&&u(s[d]);c||("value"in g&&void 0!==(d=g.value)&&(d!==e.value||"progress"===b&&!d)&&k(e,"value",d,m.value,!1),"checked"in g&&void 0!==(d=g.checked)&&d!==e.checked&&k(e,"checked",d,m.checked,!1))}return e}function V(t,n,o){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,o)}}function O(t,n,o){var r,i,l;if(e.unmount&&e.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||V(r,null,n)),o||"function"==typeof t.type||(o=null!=(i=t.__e)),t.__e=t.__d=void 0,null!=(r=t.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(t){e.__e(t,n)}r.base=r.__P=null}if(r=t.__k)for(l=0;l<r.length;l++)r[l]&&O(r[l],n,o);null!=i&&u(i)}function P(e,t,n){return this.constructor(e,n)}function G(t,n,o){var r,s,a;e.__&&e.__(t,n),s=(r="function"==typeof o)?null:o&&o.__k||n.__k,a=[],M(n,t=(!r&&o||n).__k=c(p,null,[t]),s||i,i,void 0!==n.ownerSVGElement,!r&&o?[o]:s?null:n.firstChild?l.slice.call(n.childNodes):null,a,!r&&o?o:s?s.__e:n.firstChild,r),C(a,t)}e={__e:function(e,t){for(var n,o,r;t=t.__;)if((n=t.__c)&&!n.__)try{if((o=n.constructor)&&null!=o.getDerivedStateFromError&&(n.setState(o.getDerivedStateFromError(e)),r=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),r=n.__d),r)return n.__E=n}catch(t){e=t}throw e},__v:0},_.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=a({},this.state),"function"==typeof e&&(e=e(a({},n),this.props)),e&&a(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),m(this))},_.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),m(this))},_.prototype.render=p,t=[],o="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,g.__r=0;var U=function(e,t,n,o){var r;t[0]=0;for(var i=1;i<t.length;i++){var l=t[i++],s=t[i]?(t[0]|=l?1:2,n[t[i++]]):t[++i];3===l?o[0]=s:4===l?o[1]=Object.assign(o[1]||{},s):5===l?(o[1]=o[1]||{})[t[++i]]=s:6===l?o[1][t[++i]]+=s+"":l?(r=e.apply(s,U(e,s,n,["",null])),o.push(r),s[0]?t[0]|=2:(t[i-2]=0,t[i]=r)):o.push(s)}return o},R=new Map;var E=function(e){var t=R.get(this);return t||(t=new Map,R.set(this,t)),(t=U(this,t.get(e)||(t.set(e,t=function(e){for(var t,n,o=1,r="",i="",l=[0],s=function(e){1===o&&(e||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?l.push(0,e,r):3===o&&(e||r)?(l.push(3,e,r),o=2):2===o&&"..."===r&&e?l.push(4,e,0):2===o&&r&&!e?l.push(5,0,!0,r):o>=5&&((r||!e&&5===o)&&(l.push(o,0,r,n),o=6),e&&(l.push(o,e,0,n),o=6)),r=""},a=0;a<e.length;a++){a&&(1===o&&s(),s(a));for(var u=0;u<e[a].length;u++)t=e[a][u],1===o?"<"===t?(s(),l=[l],o=3):r+=t:4===o?"--"===r&&">"===t?(o=1,r=""):r=t+r[0]:i?t===i?i="":r+=t:'"'===t||"'"===t?i=t:">"===t?(s(),o=1):o&&("="===t?(o=5,n=r,r=""):"/"===t&&(o<5||">"===e[a][u+1])?(s(),3===o&&(l=l[0]),o=l,(l=l[0]).push(2,0,o),o=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(s(),o=2):r+=t),3===o&&"!--"===r&&(o=4,l=l[0])}return s(),l}(e)),t),arguments,[])).length>1?t:t[0]}.bind(c),T=n(703);function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const j=()=>GM_setValue("lastValidatedToken",(new Date).getTime()),I=(e=!1)=>{["token","lastValidatedToken"].map(GM_deleteValue),e&&["username","password"].map(GM_deleteValue)};let D;const X=(e=!1,t=H)=>{if(!e&&D)return D;const n=GM_getValue("token"),o=GM_getValue("lastValidatedToken");return!D&&n&&+new Date-o<18e6&&(D=Promise.resolve(n)),!e&&D||(D=F(t).then((({username:e,password:n})=>{const o=new URLSearchParams;return o.set("username",e),o.set("password",n),o.set("service","moodle_mobile_app"),fetch("/login/token.php",{method:"POST",body:o.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((e=>e.hasOwnProperty("errorcode")?(I(!0),X(!0,t)):(GM_setValue("token",e.token),j(),e.token)))}))),D},B=(e=H)=>X(!1,e).then((e=>{const t=new URLSearchParams;return t.set("wsfunction","core_webservice_get_site_info"),t.set("wstoken",e),fetch("/webservice/rest/server.php?moodlewsrestformat=json",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:t.toString()})})).then((e=>e.json())).then((t=>t.hasOwnProperty("exception")?(I(),B(e)):(j(),t.userid))),F=(e=H)=>new Promise((t=>{const n=({username:e,password:n})=>{GM_setValue("username",e),GM_setValue("password",n),t({username:e,password:n})},o=GM_getValue("username"),r=GM_getValue("password");if(o&&r)t({username:o,password:r});else{e({loggedOut:!0,loggedOutCallback:n})}}));let N,$={};class A extends _{constructor(...e){super(...e),z(this,"state",$),z(this,"inputs",{}),z(this,"render",((e,{loggedOut:t})=>t&&c("div",{class:"vertical-horizontal-center"},c("div",{class:"card"},c("div",{class:"card-body"},c("h5",{class:"card-title"},"Login"),c("input",{placeholder:"Username",required:!0,class:"input-group-text",ref:e=>{this.inputs.username=e}}),c("input",{placeholder:"Password",required:!0,class:"input-group-text",ref:e=>{this.inputs.password=e},type:"password"})),c("button",{class:"btn btn-primary",onClick:this.handleClick},"Login"))))),z(this,"handleClick",(()=>{const e=this.inputs.username.value.trim(),t=this.inputs.password.value;e&&t&&(this.setState({loggedOut:!1}),this.state.loggedOutCallback({username:e,password:t}))})),z(this,"componentDidMount",(()=>{N=e=>{this.setState(e)}}))}}const H=e=>{if("function"==typeof N)N(e);else{$=e;const t=document.createElement("div");t.className="shared-login-popup",document.body.append(t),GM_addStyle(T),G(c(A,null),t)}};let q;const W=(e=!1,t=H)=>(!e&&q||(q=Promise.all([X(!1,t),B(t)]).then((([e,t])=>{const n=new URLSearchParams;return n.set("requests[0][function]","core_enrol_get_users_courses"),n.set("requests[0][arguments]",JSON.stringify({userid:t,returnusercount:!1})),n.set("wsfunction","tool_mobile_call_external_functions"),n.set("wstoken",e),fetch("/webservice/rest/server.php?moodlewsrestformat=json",{method:"POST",body:n.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>e.json()))})).then((e=>{if(e.hasOwnProperty("exception"))return I(),W(!0,t);const n=JSON.parse(e.responses[0].data),o={};for(const{id:e,fullname:t}of n)o[e]=t;return j(),o}))),q);var Y=n(630);function J(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
// ==UserScript==
// @name         Custom Icons Preact
// @version      2021.01.21b
// @author       lusc
// @updateURL    https://github.com/melusc/moodle_userscripts/raw/master/dist/Custom%20Icons/Custom%20Icons.user.js
// @include      *://moodle.ksasz.ch/*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_addValueChangeListener
// @grant        GM_registerMenuCommand
// @grant        GM_xmlhttpRequest
// @run-at       document-start
// ==/UserScript==
const K=!/^\/customiconspreact/iu.test(location.pathname),Q={error:Error("An error occured"),timeout:Error("Request timed out"),abort:Error("Request was aborted"),invalidSelector:Error("Invalid option selected"),statusCode:(e,t)=>new Error(`Error ${e}: ${t}`)},Z=()=>{GM_registerMenuCommand("Open settings",(()=>{open("/customIconsPreact/","_blank")})),addEventListener("customIconsPreact",ee),GM_getValue("pointers")||(GM_setValue("pointers",{}),GM_setValue("values",{})),ee()},ee=()=>{const e=_e(document);if(fe(e)){const t=Object.keys(GM_getValue("pointers"));for(let n=0;n<t.length;n++)te(t[n],e);GM_addValueChangeListener("pointers",oe)}},te=(e,t)=>{const n=t.querySelector(`a[href="https://moodle.ksasz.ch/course/view.php?id=${e}"]`);if(fe(n)){if(n.childElementCount>0){const t=ne(e);if("object"!=typeof t)return;if(t.isXML){const e=document.createElement("span");e.className="icon navicon",e.style.display="inline-block",e.style.color="var(--svg-fill, inherit)",G(E([t.rawXML]),e),n.firstElementChild.replaceWith(e)}else{const e=document.createElement("img");e.classList.add("icon","navicon"),e.setAttribute("aria-hidden",!0),e.style="fill: var(--svg-fill, inherit);stroke: var(--svg-fill, inherit);-moz-context-properties: fill, stroke;",e.tabIndex=-1,e.src=t.blobURL,e.addEventListener("load",(()=>{URL.revokeObjectURL(t)}),{once:!0}),n.firstElementChild.replaceWith(e)}}}else re(e)},ne=e=>{const t=ge(e);if("object"==typeof t){if(t.isXML)return t;const{mediaType:e,rawByteString:n}=t,o=atob(n),{length:r}=o,i=new ArrayBuffer(r),l=new Uint8Array(i);for(let e=0;e<r;e++)l[e]=o.charCodeAt(e);const s=new Blob([l],{type:e});return{blobURL:URL.createObjectURL(s),isXML:!1}}},oe=(e,t,n,o)=>{if(!0===o){const e=_e(document),o=Object.entries(t),r=Object.entries(n).filter((([e,n])=>!1===t.hasOwnProperty(e)&&t[e]!==n)),i=o.filter((([e])=>!1===n.hasOwnProperty(e)));for(let t=0;t<i.length;t++){const[n]=i[t],o=e.querySelector(`a[href="https://moodle.ksasz.ch/course/view.php?id=${n}"] > .icon.navicon`);if(o&&("SPAN"===o.nodeName||"IMG"===o.nodeName)){const e=document.createElement("i");e.classList.add("icon","fa","fa-graduation-cap","fa-fw","navicon"),e.setAttribute("aria-hidden",!0),e.tabIndex=-1,o.replaceWith(e)}}for(let t=0;t<r.length;t++)te(r[t][0],e)}},re=e=>{W(!1,ae).then((t=>{t.hasOwnProperty(e)||(ve(e),alert(`You appear to not be in the course with the id "${e}" anymore.\nThe course will not be checked for anymore`))}))},ie=()=>{history.replaceState({},"","/customIconsPreact/"),document.title="Custom Icons Preact Setup",GM_addStyle(Y);const e=document.createElement("link");for(e.rel="shortcut icon",e.href='data:image/svg+xml,%3Csvg xmlns%3D"http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" viewBox%3D"0 74.46 344.72 235.31"%3E%3Cpath fill%3D"%23f98012" d%3D"M289.61 309.77V201.51q0-33.94-28-33.95t-28.06 33.95v108.26H178.4V201.51q0-33.94-27.57-33.95-28.05 0-28 33.95v108.26H67.67V195.12q0-35.43 24.6-53.63 21.66-16.25 58.56-16.25 37.41 0 55.12 19.19 15.26-19.19 55.62-19.19 36.9 0 58.54 16.25 24.6 18.19 24.61 53.63v114.65z"%2F%3E%3Cpath fill%3D"%23333" d%3D"M174.74 116.9l54.74-40-.7-2.44C130 86.57 85.08 95.15 0 144.47l.79 2.24 6.76.07c-.62 6.81-1.7 23.64-.32 48.95-9.44 27.32-.24 45.88 8.4 66.07 1.37-21 1.23-44-5.22-66.89-1.35-25.14-.24-41.67.37-48.1l56.4.54a258 258 0 001.67 33.06c50.4 17.71 101.09-.06 128-43.72-7.47-8.37-22.11-19.79-22.11-19.79z"%2F%3E%3C%2Fsvg%3E',document.head.append(e);document.body.lastChild;)document.body.lastChild.remove();G(c(se,null),document.body)};let le;class se extends _{constructor(...e){super(...e),J(this,"state",{courses:[],notificationString:null,inputStates:{urlVal:"",fileVal:null,copyVal:null,current:null},loggedOut:!1,loggedOutCallback:null}),J(this,"inputRefs",{}),J(this,"render",((e,{courses:t,selectedCourse:n,inputStates:o,notificationString:r})=>c("div",{class:"container"},c(ue,{courses:t,handleClick:this.handleSidebarClick,blur:`${fe(r)}`}),c(pe,{selectedCourse:n,courses:t,handleInput:this.handleMainInput,inputStates:o,handleSave:this.handleSave,inputRefs:this.inputRefs,blur:`${fe(r)}`,loggedOut:this.state.loggedOut,loggedOutCallback:this.loggedOutCallbackHandler}),r&&c(ce,{handleClick:this.handleNotificationClick,notificationString:r})))),J(this,"loggedOutCallbackHandler",(e=>{this.state.loggedOutCallback(e),this.setState({loggedOut:!1,loggedOutCallback:null})})),J(this,"handleSidebarClick",(e=>{const{target:t}=e,n=t.closest(".row"),o=t.closest("svg"),r=o?.classList,{id:i}=n.dataset;if(fe(o)&&r.contains("svg-icon-x")){ve(i);const e=[...this.state.courses];for(let t=0;t<e.length;t++)if(e[t].id===i){e[t]={...e[t],dataURI:null,rawXML:null,isXML:null};break}this.setState({selectedCourse:null,courses:e})}else if(fe(n)){const e=this.state.courses.find((e=>e.id===i));this.setState({selectedCourse:{...e}}),scroll({top:0,left:0,behavior:"smooth"})}})),J(this,"saveHandlers",{url:e=>new Promise(((t,n)=>{const o=e.urlVal;GM_xmlhttpRequest({method:"GET",url:o,timeout:15e3,responseType:"blob",anonymous:!0,onabort:()=>n(Q.abort),onerror:()=>{n(Q.error)},ontimeout:()=>n(Q.timeout),onload:e=>{200===e.status?this.saveHandlers.useFileReader(e.response).then(t).catch(n):n(Q.statusCode(e.status,e.statusText))}})})),file:e=>new Promise(((t,n)=>{this.saveHandlers.useFileReader(e.fileVal).then(t).catch(n)})),copy:e=>new Promise(((t,n)=>{const o=e.copyVal,r=GM_getValue("pointers");if(r.hasOwnProperty(o)){const{id:e}=this.state.selectedCourse;ve(e),r[e]=r[o],GM_setValue("pointers",r),t()}else n(Q.invalidSelector)})),useFileReader:e=>new Promise(((t,n)=>{const o=new FileReader;o.onload=()=>{const e=document.createElement("img");e.onerror=()=>n(Q.error),e.onload=()=>{const{id:e}=this.state.selectedCourse,n=GM_getValue("pointers"),r=me();ve(e);const i=GM_getValue("values"),{mediaType:l,isBase64:s,rawByteString:a}=o.result.match(/^data:(?<mediaType>[\w+/]+);(?<isBase64>base64,)?(?<rawByteString>.+)$/).groups,u={mediaType:l};if("image/svg+xml"===l){const e=decodeURI(s?atob(a):a);u.rawXML=e}else u.rawByteString=s?a:btoa(decodeURI(a));i[r]=u,GM_setValue("values",i),n[e]=r,GM_setValue("pointers",n),t()},e.src=o.result},o.onerror=()=>n(Q.error),o.readAsDataURL(e)}))}),J(this,"handleSave",(()=>{const{inputStates:e,selectedCourse:t}=this.state;if(fe(t)){const t=e.current;fe(t)?this.saveHandlers[t](e).then((()=>{const{id:e}=this.state.selectedCourse;this.setState((t=>{const n=[...t.courses];for(let t=0;t<n.length;t++)if(n[t].id===e){const o=ge(e);if(n[t].isXML=o.isXML)n[t].rawXML=o.rawXML;else{const{mediaType:e,rawByteString:r}=o;n[t].dataURI=`data:${e};base64,${r}`}break}return{courses:n}}));const t=Object.values(this.inputRefs);for(let e=0;e<t.length;e++)t[e].value=null;this.setState({inputStates:{urlVal:"",fileVal:null,copyVal:null,current:null},selectedCourse:null})})).catch((e=>{this.setState({notificationString:e.message})})):this.setState({notificationString:"You haven't submitted an icon"})}else this.setState({notificationString:"You haven't selected a course"})})),J(this,"handleNotificationClick",(({target:e})=>{const t=e.closest("svg");(fe(t)||e.classList.contains("outer-notification"))&&this.setState({notificationString:null})})),J(this,"inputHandlers",{file:(e,t)=>{const n=e.files[0];t.fileVal=n,t.current=fe(n)?"file":null},url:(e,t)=>{const n=e.value.trim();t.urlVal=n,t.current=""===n?null:"url"},copy:(e,t)=>{const n=e.value;[t.copyVal,t.current]="null"===n?[null,null]:[n,"copy"]}}),J(this,"handleMainInput",(e=>{const{target:t}=e;this.setState((e=>{const n={...e.inputStates},o=t.dataset.inputType;return this.inputHandlers[o](t,n),{inputStates:n}}))}))}componentDidMount(){le=this.setState.bind(this),W(!1,ae).then((e=>{const t=Object.entries(e).map((([e,t])=>{const n=ge(e);let o,r,i;if("object"==typeof n)if(({isXML:i}=n),i)({rawXML:r}=n);else{const{mediaType:e,rawByteString:t}=n;o=`data:${e};base64,${t}`}return{id:e,name:t.trim(),dataURI:o,isXML:i,rawXML:r}}));t.sort(((e,t)=>{const n=e.name.toLowerCase(),o=t.name.toLowerCase();return n<o?-1:n>o?1:0})),this.setState({courses:t})}))}}const ae=K?void 0:e=>{le(e)},ue=({blur:e,courses:t,handleClick:n})=>c("div",{"data-blur":e,class:"outer-sidebar",onClick:n},c("div",{class:"sidebar"},t?.map((({id:e,dataURI:t,name:n,isXML:o,rawXML:r})=>c("div",{class:"row","data-id":e,key:e},"boolean"==typeof o&&c(p,null,o?c("span",{class:"icon"},E([r])):c("img",{class:"icon",src:t}),c(de,{type:"del-icon"})),c("span",null,n))))));class ce extends _{constructor(...e){super(...e),J(this,"render",(({handleClick:e,notificationString:t})=>c("div",{onClick:e,class:"outer-notification"},c("div",{class:"inner-notification"},c(de,{type:"close"}),c("div",{class:"notification-string"},t)))))}componentDidMount(){scroll({top:0,left:0,behavior:"smooth"})}}const de=e=>c("svg",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2","data-svg-type":e.type,class:"svg-icon svg-icon-x",viewBox:"0 0 24 24",onClick:e.handleClick},c("path",{d:"M24 0L0 24M0 0l24 24"}));class pe extends _{constructor(...e){super(...e),J(this,"inputs",{}),J(this,"render",(({selectedCourse:e,courses:t,inputStates:n,blur:o,handleInput:r,inputRefs:i,handleSave:l,loggedOut:s})=>{const a=ge(e?.id);let u,d,_;if("object"==typeof a)if(({isXML:d}=a),d)({rawXML:_}=a);else{const{mediaType:e,rawByteString:t}=a;u=`data:${e};base64,${t}`}const f=e?.name,h=e?.id,{fileVal:m}=n;return c("div",{class:"outer-main","data-blur":o},c("div",{class:"main",onInput:r},s?c("div",{class:"replace-flex-input"},c("h2",null,"Login"),c("input",{placeholder:"Username",ref:e=>{this.inputs.username=e}}),c("input",{placeholder:"Password",ref:e=>{this.inputs.password=e},type:"password"}),c("button",{class:"btn-save",onClick:this.handleLoggedOutBtnClick},"Login")):c(p,null,c("h2",null,"Modify existing or add an icon"),c("div",null,u&&(d?E([_]):c("img",{src:u,class:"icon"})),c("span",null,f??"Select course on left")),c("h3",null,"Upload image from URL"),c("input",{type:"url",placeholder:"Image url",URL:!0,"data-input-type":"url",ref:e=>{i.url=e},disabled:null!==n.current&&"url"!==n.current}),c("h3",null,"Upload image from file"),c("input",{"data-input-type":"file",type:"file",hidden:!0,ref:e=>{i.file=e}}),c("button",{disabled:null!==n.current&&"file"!==n.current,onClick:()=>{i.file.click()}},fe(m)?m.name:"Upload file",fe(m)&&c(de,{type:"clear",handleClick:this.clearFile})),c("h3",null,"Copy image from other course"),c("select",{disabled:null!==n.current&&"copy"!==n.current,ref:e=>{i.copy=e},"data-input-type":"copy"},c("option",{value:"null",defaultValue:!0},"Select course to copy icon from"),t?.map((({id:e,name:t,dataURI:n,rawXML:o})=>(n||o)&&c("option",{key:h,value:e,disabled:e===h},t)))),c("button",{onClick:l,class:"btn-save"},"Save"))))})),J(this,"handleLoggedOutBtnClick",(()=>{const e=this.inputs.username.value.trim(),t=this.inputs.password.value;e&&t&&this.props.loggedOutCallback({username:e,password:t})})),J(this,"clearFile",(e=>{const t=this.props.inputRefs.file;t.files.length>0&&(t.value=null,this.props.handleInput({target:t})),e.stopPropagation()}))}}const _e=e=>e.querySelector('li[aria-labelledby="label_2_4"] ul[role="group"]')??e.getElementById("label_3_21")?.closest('ul[role="group"]'),fe=e=>null!=e,he=e=>null==e,me=e=>e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,me),ge=e=>{if(he(e))return;const t=GM_getValue("pointers");if(he(t))return GM_setValue("values",{}),void GM_setValue("pointers",{});const n=t[e];if(he(n))return;const o=GM_getValue("values")[n];return o.hasOwnProperty("rawXML")?{rawXML:o.rawXML,isXML:!0}:{...o,isXML:!1}},ve=e=>{const t=GM_getValue("pointers"),n=GM_getValue("values"),o=t[e];if(fe(o)){delete t[e];!1===Object.values(t).includes(o)&&(delete n[o],GM_setValue("values",n)),GM_setValue("pointers",t)}};if(!/^\/cleanmoodle/iu.test(location.pathname)){const e=K?Z:ie;"complete"===document.readyState?e():addEventListener("DOMContentLoaded",e,{once:!0})}})()})();