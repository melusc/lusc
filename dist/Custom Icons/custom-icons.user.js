(()=>{var e={713:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},154:e=>{function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},t.apply(this,arguments)}e.exports=t},630:e=>{"use strict";e.exports='html{cursor:default;-moz-tab-size:4;tab-size:4;-webkit-tap-highlight-color:transparent;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";background:#202020;color:#ccc;font-size:.9375rem;font-weight:400;line-height:1.5;user-select:none}a{background-color:transparent}button,input,select{font-family:inherit;font-size:100%;line-height:1.15}button::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring{outline:1px dotted ButtonText}*,::after,::before{box-sizing:border-box}::after,::before{text-decoration:inherit;vertical-align:inherit}body,button,input,select{margin:0}img,svg{vertical-align:middle}img{border-style:none}svg:not(:root){overflow:hidden}button{-webkit-appearance:button}button,input{overflow:visible}button,select{text-transform:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}[tabindex],a,button,input,select{-ms-touch-action:manipulation;touch-action:manipulation}[hidden]{display:none}[disabled]{cursor:not-allowed}@media (min-width:0px){:root{--sidebar-flex: 0 0 100%;--main-flex: 0 0 100%;--padding-horizontal: 0;--padding-vertical: 0.5%}}@media (min-width:768px){:root{--sidebar-flex: 0 0 32%;--main-flex: 0 0 68%;--padding-horizontal: 0.5%;--padding-vertical: 0}}@media (min-width:992px){:root{--sidebar-flex: 0 0 25%;--main-flex: 0 0 75%}}@media (min-width:1200px){:root{--sidebar-flex: 0 0 20%;--main-flex: 0 0 80%}}.outer-sidebar{flex:var(--sidebar-flex);padding-right:var(--padding-horizontal);padding-bottom:var(--padding-vertical)}.outer-sidebar .sidebar{display:flex;flex-direction:column;padding:10px 15px;border:1.5px solid #343434;border-radius:4px;background-color:#141414}.outer-sidebar .row{cursor:pointer}.outer-sidebar .row:hover{text-decoration:underline}.outer-sidebar .row[data-removed=false]{color:#2ecc40}.outer-sidebar .row[data-removed=true],.svg-icon-x.svg-clear,.svg-icon-x.svg-del-icon{color:#ff4136}h2,h3{font-weight:300}h2{font-size:1.875rem}h3{font-size:1.64rem}input{margin-top:5px;width:220px}button,input,select{display:block;background:0 0;box-shadow:none;border:1.5px solid #343434;color:inherit;border-radius:2px;padding:5px 15px;max-width:100%;min-width:max-content;outline:0}button:disabled,input:disabled,select:disabled{color:gray}select>option{color:#111}button,select{width:auto}button:enabled,select:enabled{cursor:pointer}.svg-icon-x{margin-left:5px;height:1em;width:1em;cursor:pointer}.svg-icon-x.svg-del-icon{margin-left:0;margin-right:5px}.svg-icon-x.svg-close{color:#111;grid-column-start:3;grid-row-start:1;margin-left:auto}.btn-save{margin-top:10px;display:block}.icon{height:16px;width:16px;margin-right:5px}.icon:not(span){fill:#ccc;stroke:#ccc;-moz-context-properties:fill,stroke}span.icon{display:inline-block}.outer-main{flex:var(--main-flex);padding-left:var(--padding-horizontal);padding-top:var(--padding-vertical)}.main{padding:1.25rem 2.25rem;border:1.5px solid #343434;border-radius:4px;background-color:#141414}.container{padding:1%;display:flex;flex-direction:row;flex-wrap:wrap;width:100%;height:max-content}.outer-notification{position:absolute;top:0;left:0;width:100%;min-height:100%}.notification-string,.outer-notification{display:flex;justify-content:center;align-items:center}.inner-notification{display:grid;grid-template-columns:1fr auto 1fr;grid-template-rows:1fr auto 1fr;justify-items:center;width:375px;height:300px;max-height:90vh;max-width:90vw;background:#fff;border:#ddd solid 2px;border-radius:4px;padding:1em}.notification-string{grid-area:2/2/3/3;text-align:center;color:#111}.blur{filter:blur(4px);overflow:hidden}'},604:e=>{"use strict";e.exports=".shared-login-popup .vertical-horizontal-center{width:100%;height:100%;position:fixed;z-index:100000000;top:0;left:0;display:flex;align-items:center;justify-content:center;pointer-events:none}.shared-login-popup .card{pointer-events:auto}"}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e,t,o,r,i={},s=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function a(e,t){for(var n in t)e[n]=t[n];return e}function c(e){var t=e.parentNode;t&&t.removeChild(e)}function u(e,t,n){var o,r,i,s=arguments,l={};for(i in t)"key"==i?o=t[i]:"ref"==i?r=t[i]:l[i]=t[i];if(arguments.length>3)for(n=[n],i=3;i<arguments.length;i++)n.push(s[i]);if(null!=n&&(l.children=n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===l[i]&&(l[i]=e.defaultProps[i]);return d(e,l,o,r,null)}function d(t,n,o,r,i){var s={type:t,props:n,key:o,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==i?++e.__v:i};return null!=e.vnode&&e.vnode(s),s}function _(e){return e.children}function p(e,t){this.props=e,this.context=t}function h(e,t){if(null==t)return e.__?h(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?h(e):null}function f(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return f(e)}}function m(n){(!n.__d&&(n.__d=!0)&&t.push(n)&&!v.__r++||r!==e.debounceRendering)&&((r=e.debounceRendering)||o)(v)}function v(){for(var e;v.__r=t.length;)e=t.sort((function(e,t){return e.__v.__b-t.__v.__b})),t=[],e.some((function(e){var t,n,o,r,i,s;e.__d&&(i=(r=(t=e).__v).__e,(s=t.__P)&&(n=[],(o=a({},r)).__v=r.__v+1,M(s,r,o,t.__n,void 0!==s.ownerSVGElement,null!=r.__h?[i]:null,n,null==i?h(r):i,r.__h),C(n,r),r.__e!=i&&f(r)))}))}function g(e,t,n,o,r,l,a,c,u,p){var f,m,v,g,w,k,x,S=o&&o.__k||s,C=S.length;for(n.__k=[],f=0;f<t.length;f++)if(null!=(g=n.__k[f]=null==(g=t[f])||"boolean"==typeof g?null:"string"==typeof g||"number"==typeof g?d(null,g,null,null,g):Array.isArray(g)?d(_,{children:g},null,null,null):g.__b>0?d(g.type,g.props,g.key,null,g.__v):g)){if(g.__=n,g.__b=n.__b+1,null===(v=S[f])||v&&g.key==v.key&&g.type===v.type)S[f]=void 0;else for(m=0;m<C;m++){if((v=S[m])&&g.key==v.key&&g.type===v.type){S[m]=void 0;break}v=null}M(e,g,v=v||i,r,l,a,c,u,p),w=g.__e,(m=g.ref)&&v.ref!=m&&(x||(x=[]),v.ref&&x.push(v.ref,null,g),x.push(m,g.__c||w,g)),null!=w?(null==k&&(k=w),"function"==typeof g.type&&null!=g.__k&&g.__k===v.__k?g.__d=u=b(g,u,e):u=y(e,g,v,S,w,u),p||"option"!==n.type?"function"==typeof n.type&&(n.__d=u):e.value=""):u&&v.__e==u&&u.parentNode!=e&&(u=h(v))}for(n.__e=k,f=C;f--;)null!=S[f]&&("function"==typeof n.type&&null!=S[f].__e&&S[f].__e==n.__d&&(n.__d=h(o,f+1)),V(S[f],S[f]));if(x)for(f=0;f<x.length;f++)I(x[f],x[++f],x[++f])}function b(e,t,n){var o,r;for(o=0;o<e.__k.length;o++)(r=e.__k[o])&&(r.__=e,t="function"==typeof r.type?b(r,t,n):y(n,r,r,e.__k,r.__e,t));return t}function y(e,t,n,o,r,i){var s,l,a;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(null==n||r!=i||null==r.parentNode)e:if(null==i||i.parentNode!==e)e.appendChild(r),s=null;else{for(l=i,a=0;(l=l.nextSibling)&&a<o.length;a+=2)if(l==r)break e;e.insertBefore(r,i),s=i}return void 0!==s?s:r.nextSibling}function w(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]=null==n?"":"number"!=typeof n||l.test(t)?n:n+"px"}function k(e,t,n,o,r){var i;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof o&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||w(e.style,t,"");if(n)for(t in n)o&&n[t]===o[t]||w(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])i=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?o||e.addEventListener(t,i?S:x,i):e.removeEventListener(t,i?S:x,i);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"download"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null!=n&&(!1!==n||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,n):e.removeAttribute(t))}}function x(t){this.l[t.type+!1](e.event?e.event(t):t)}function S(t){this.l[t.type+!0](e.event?e.event(t):t)}function M(t,n,o,r,i,s,l,c,u){var d,h,f,m,v,b,y,w,k,x,S,M=n.type;if(void 0!==n.constructor)return null;null!=o.__h&&(u=o.__h,c=n.__e=o.__e,n.__h=null,s=[c]),(d=e.__b)&&d(n);try{e:if("function"==typeof M){if(w=n.props,k=(d=M.contextType)&&r[d.__c],x=d?k?k.props.value:d.__:r,o.__c?y=(h=n.__c=o.__c).__=h.__E:("prototype"in M&&M.prototype.render?n.__c=h=new M(w,x):(n.__c=h=new p(w,x),h.constructor=M,h.render=U),k&&k.sub(h),h.props=w,h.state||(h.state={}),h.context=x,h.__n=r,f=h.__d=!0,h.__h=[]),null==h.__s&&(h.__s=h.state),null!=M.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=a({},h.__s)),a(h.__s,M.getDerivedStateFromProps(w,h.__s))),m=h.props,v=h.state,f)null==M.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==M.getDerivedStateFromProps&&w!==m&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(w,x),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(w,h.__s,x)||n.__v===o.__v){h.props=w,h.state=h.__s,n.__v!==o.__v&&(h.__d=!1),h.__v=n,n.__e=o.__e,n.__k=o.__k,h.__h.length&&l.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(w,h.__s,x),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(m,v,b)}))}h.context=x,h.props=w,h.state=h.__s,(d=e.__r)&&d(n),h.__d=!1,h.__v=n,h.__P=t,d=h.render(h.props,h.state,h.context),h.state=h.__s,null!=h.getChildContext&&(r=a(a({},r),h.getChildContext())),f||null==h.getSnapshotBeforeUpdate||(b=h.getSnapshotBeforeUpdate(m,v)),S=null!=d&&d.type===_&&null==d.key?d.props.children:d,g(t,Array.isArray(S)?S:[S],n,o,r,i,s,l,c,u),h.base=n.__e,n.__h=null,h.__h.length&&l.push(h),y&&(h.__E=h.__=null),h.__e=!1}else null==s&&n.__v===o.__v?(n.__k=o.__k,n.__e=o.__e):n.__e=L(o.__e,n,o,r,i,s,l,u);(d=e.diffed)&&d(n)}catch(t){n.__v=null,(u||null!=s)&&(n.__e=c,n.__h=!!u,s[s.indexOf(c)]=null),e.__e(t,n,o)}}function C(t,n){e.__c&&e.__c(n,t),t.some((function(n){try{t=n.__h,n.__h=[],t.some((function(e){e.call(n)}))}catch(t){e.__e(t,n.__v)}}))}function L(e,t,n,o,r,l,a,u){var d,_,p,h,f=n.props,m=t.props,v=t.type,b=0;if("svg"===v&&(r=!0),null!=l)for(;b<l.length;b++)if((d=l[b])&&(d===e||(v?d.localName==v:3==d.nodeType))){e=d,l[b]=null;break}if(null==e){if(null===v)return document.createTextNode(m);e=r?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,m.is&&m),l=null,u=!1}if(null===v)f===m||u&&e.data===m||(e.data=m);else{if(l=l&&s.slice.call(e.childNodes),_=(f=n.props||i).dangerouslySetInnerHTML,p=m.dangerouslySetInnerHTML,!u){if(null!=l)for(f={},h=0;h<e.attributes.length;h++)f[e.attributes[h].name]=e.attributes[h].value;(p||_)&&(p&&(_&&p.__html==_.__html||p.__html===e.innerHTML)||(e.innerHTML=p&&p.__html||""))}if(function(e,t,n,o,r){var i;for(i in n)"children"===i||"key"===i||i in t||k(e,i,null,n[i],o);for(i in t)r&&"function"!=typeof t[i]||"children"===i||"key"===i||"value"===i||"checked"===i||n[i]===t[i]||k(e,i,t[i],n[i],o)}(e,m,f,r,u),p)t.__k=[];else if(b=t.props.children,g(e,Array.isArray(b)?b:[b],t,n,o,r&&"foreignObject"!==v,l,a,e.firstChild,u),null!=l)for(b=l.length;b--;)null!=l[b]&&c(l[b]);u||("value"in m&&void 0!==(b=m.value)&&(b!==e.value||"progress"===v&&!b)&&k(e,"value",b,f.value,!1),"checked"in m&&void 0!==(b=m.checked)&&b!==e.checked&&k(e,"checked",b,f.checked,!1))}return e}function I(t,n,o){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,o)}}function V(t,n,o){var r,i,s;if(e.unmount&&e.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||I(r,null,n)),o||"function"==typeof t.type||(o=null!=(i=t.__e)),t.__e=t.__d=void 0,null!=(r=t.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(t){e.__e(t,n)}r.base=r.__P=null}if(r=t.__k)for(s=0;s<r.length;s++)r[s]&&V(r[s],n,o);null!=i&&c(i)}function U(e,t,n){return this.constructor(e,n)}function P(t,n,o){var r,l,a;e.__&&e.__(t,n),l=(r="function"==typeof o)?null:o&&o.__k||n.__k,a=[],M(n,t=(!r&&o||n).__k=u(_,null,[t]),l||i,i,void 0!==n.ownerSVGElement,!r&&o?[o]:l?null:n.firstChild?s.slice.call(n.childNodes):null,a,!r&&o?o:l?l.__e:n.firstChild,r),C(a,t)}e={__e:function(e,t){for(var n,o,r;t=t.__;)if((n=t.__c)&&!n.__)try{if((o=n.constructor)&&null!=o.getDerivedStateFromError&&(n.setState(o.getDerivedStateFromError(e)),r=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e),r=n.__d),r)return n.__E=n}catch(t){e=t}throw e},__v:0},p.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=a({},this.state),"function"==typeof e&&(e=e(a({},n),this.props)),e&&a(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),m(this))},p.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),m(this))},p.prototype.render=_,t=[],o="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,v.__r=0;var E=function(e,t,n,o){var r;t[0]=0;for(var i=1;i<t.length;i++){var s=t[i++],l=t[i]?(t[0]|=s?1:2,n[t[i++]]):t[++i];3===s?o[0]=l:4===s?o[1]=Object.assign(o[1]||{},l):5===s?(o[1]=o[1]||{})[t[++i]]=l:6===s?o[1][t[++i]]+=l+"":s?(r=e.apply(l,E(e,l,n,["",null])),o.push(r),l[0]?t[0]|=2:(t[i-2]=0,t[i]=r)):o.push(l)}return o},O=new Map,G=function(e){var t=O.get(this);return t||(t=new Map,O.set(this,t)),(t=E(this,t.get(e)||(t.set(e,t=function(e){for(var t,n,o=1,r="",i="",s=[0],l=function(e){1===o&&(e||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?s.push(0,e,r):3===o&&(e||r)?(s.push(3,e,r),o=2):2===o&&"..."===r&&e?s.push(4,e,0):2===o&&r&&!e?s.push(5,0,!0,r):o>=5&&((r||!e&&5===o)&&(s.push(o,0,r,n),o=6),e&&(s.push(o,e,0,n),o=6)),r=""},a=0;a<e.length;a++){a&&(1===o&&l(),l(a));for(var c=0;c<e[a].length;c++)t=e[a][c],1===o?"<"===t?(l(),s=[s],o=3):r+=t:4===o?"--"===r&&">"===t?(o=1,r=""):r=t+r[0]:i?t===i?i="":r+=t:'"'===t||"'"===t?i=t:">"===t?(l(),o=1):o&&("="===t?(o=5,n=r,r=""):"/"===t&&(o<5||">"===e[a][c+1])?(l(),3===o&&(s=s[0]),o=s,(s=s[0]).push(2,0,o),o=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(l(),o=2):r+=t),3===o&&"!--"===r&&(o=4,s=s[0])}return l(),s}(e)),t),arguments,[])).length>1?t:t[0]}.bind(u),R=n(713),j=n.n(R),H=n(604);let T,z={};class N extends p{constructor(...e){super(...e),j()(this,"state",z),j()(this,"inputs",{username:{current:null},password:{current:null}}),j()(this,"render",((e,{loggedOut:t})=>t&&u("div",{class:"vertical-horizontal-center"},u("div",{class:"card"},u("div",{class:"card-body"},u("h5",{class:"card-title"},"Login"),u("input",{placeholder:"Username",required:!0,class:"input-group-text",ref:this.inputs.username}),u("input",{placeholder:"Password",required:!0,class:"input-group-text",ref:this.inputs.password,type:"password"})),u("button",{class:"btn btn-primary",type:"button",onClick:this.handleClick},"Login"))))),j()(this,"handleClick",(()=>{const e=this.inputs.username.current.value.trim(),t=this.inputs.password.current.value;this.state.loggedOutCallback({username:e,password:t})})),j()(this,"componentDidMount",(()=>{T=this.setState.bind(this)}))}}const A=e=>{if("function"==typeof T)T(e);else{z=e;const t=document.createElement("div");t.className="shared-login-popup",document.body.append(t),GM_addStyle(H),P(u(N,null),t)}},B=(e=!1)=>{for(const e of["token","lastValidatedToken"])GM_deleteValue(e);if(e)for(const e of["username","password"])GM_deleteValue(e)},D=()=>GM_setValue("lastValidatedToken",Date.now());let X;const F=(e=!1,t=A)=>{if(!e&&X)return X;const n=GM_getValue("token"),o=GM_getValue("lastValidatedToken");return!X&&n&&Date.now()-o<18e6&&(X=Promise.resolve(n)),!e&&X||(X=((e=A)=>new Promise((t=>{const n=GM_getValue("username"),o=GM_getValue("password");n&&o?t({username:n,password:o}):e({loggedOut:!0,loggedOutCallback:({username:n,password:o})=>{n&&o&&(GM_setValue("username",n),GM_setValue("password",o),e({loggedOut:!1,loggedOutCallback:void 0}),t({username:n,password:o}))}})})))(t).then((({username:e,password:n})=>{const o=new URLSearchParams({username:e,password:n,service:"moodle_mobile_app"});return fetch("/login/token.php",{method:"POST",body:o.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((e=>"errorcode"in e?(B(!0),F(!0,t)):(GM_setValue("token",e.token),D(),e.token)))}))),X},q=(e=A)=>F(!1,e).then((e=>{const t=new URLSearchParams({wsfunction:"core_webservice_get_site_info",wstoken:e});return fetch("/webservice/rest/server.php?moodlewsrestformat=json",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:t.toString()})})).then((e=>e.json())).then((t=>"exception"in t?(B(),q(e)):(D(),t.userid)));let W;const $=(e=!1,t=A)=>(!e&&W||(W=Promise.all([F(e,t),q(t)]).then((([e,t])=>{const n=new URLSearchParams({"requests[0][function]":"core_enrol_get_users_courses","requests[0][arguments]":JSON.stringify({userid:t,returnusercount:!1}),wstoken:e});return fetch("/webservice/rest/server.php?moodlewsrestformat=json&wsfunction=tool_mobile_call_external_functions",{method:"POST",body:n.toString(),headers:{"content-type":"application/x-www-form-urlencoded"}}).then((e=>e.json()))})).then((e=>{if("exception"in e)return B(),$(!0,t);const n=JSON.parse(e.responses[0].data),o={};for(const{id:e,fullname:t}of n)o[e]=t;return D(),o}))),W);var Y,J,K,Q=n(154),Z=n.n(Q),ee=0,te=[],ne=e.__b,oe=e.__r,re=e.diffed,ie=e.__c,se=e.unmount;function le(t,n){e.__h&&e.__h(J,t,ee||n),ee=0;var o=J.__H||(J.__H={__:[],__h:[]});return t>=o.__.length&&o.__.push({}),o.__[t]}function ae(e){return ee=5,function(e,t){var n=le(Y++,7);return pe(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}((function(){return{current:e}}),[])}function ce(){te.forEach((function(t){if(t.__P)try{t.__H.__h.forEach(de),t.__H.__h.forEach(_e),t.__H.__h=[]}catch(n){t.__H.__h=[],e.__e(n,t.__v)}})),te=[]}e.__b=function(e){J=null,ne&&ne(e)},e.__r=function(e){oe&&oe(e),Y=0;var t=(J=e.__c).__H;t&&(t.__h.forEach(de),t.__h.forEach(_e),t.__h=[])},e.diffed=function(t){re&&re(t);var n=t.__c;n&&n.__H&&n.__H.__h.length&&(1!==te.push(n)&&K===e.requestAnimationFrame||((K=e.requestAnimationFrame)||function(e){var t,n=function(){clearTimeout(o),ue&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,100);ue&&(t=requestAnimationFrame(n))})(ce)),J=void 0},e.__c=function(t,n){n.some((function(t){try{t.__h.forEach(de),t.__h=t.__h.filter((function(e){return!e.__||_e(e)}))}catch(o){n.some((function(e){e.__h&&(e.__h=[])})),n=[],e.__e(o,t.__v)}})),ie&&ie(t,n)},e.unmount=function(t){se&&se(t);var n=t.__c;if(n&&n.__H)try{n.__H.__.forEach(de)}catch(t){e.__e(t,n.__v)}};var ue="function"==typeof requestAnimationFrame;function de(e){var t=J;"function"==typeof e.__c&&e.__c(),J=t}function _e(e){var t=J;e.__c=e.__(),J=t}function pe(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}var he=n(630);const fe=e=>{const t=GM_getValue("pointers"),n=GM_getValue("values"),o=t[e];o&&(delete t[e],Object.values(t).includes(o)||(delete n[o],GM_setValue("values",n)),GM_setValue("pointers",t))},me="FILE",ve="COPY",ge="URL",be="An error occured",ye=()=>{"https:"!==location.protocol&&(location.protocol="https:");const{body:e,head:t}=document;for(;e.lastChild;)e.lastChild.remove();for(;t.lastChild;)t.lastChild.remove();const n=document.createElement("link");n.rel="shortcut icon",n.href="/theme/image.php/classic/theme/1606210545/favicon",t.append(n),document.title="Custom Icons Setup",history.replaceState({},"","/customIconsPreact"),GM_addStyle(he),P(u(we,null),e)};class we extends p{constructor(...e){super(...e),j()(this,"state",{courses:[],selected:{isSelected:!1},notificationString:void 0,inputVals:{current:!1}}),j()(this,"form",{current:null}),j()(this,"render",((e,{courses:t,selected:n,inputVals:{current:o,val:r},loggedOut:i,loggedOutCallback:s,notificationString:l})=>u(_,null,u("div",{class:"container"+(l?" blur":"")},u(xe,{courses:t,rowClick:this.rowClick,delIcon:this.delIcon}),u(Le,{courses:t,selected:n,handleInput:this.handleMainInput,currentInput:o,currentInputVal:r,loggedOut:i,loggedOutCallback:s,handleSave:this.handleSave,formRef:this.form,reset:this.reset})),l&&u(Ie,{handleClick:this.closeNotification,notificationString:l})))),j()(this,"closeNotification",((e,t)=>{e.stopImmediatePropagation(),t&&e.target.classList.contains("outer-notification")||this.setState({notificationString:void 0})})),j()(this,"handleSave",(()=>{const{isSelected:e}=this.state.selected;if(e){const e=this.state.inputVals.current;if(e){const{val:t}=this.state.inputVals;e===ge?this.saveHandlers.saveByURL(t):e===me?this.saveHandlers.saveWithFileHandler(t):e===ve&&this.saveHandlers.saveByCopy(t)}else this.setState({notificationString:"You haven't submitted an icon"})}else this.setState({notificationString:"You haven't selected a course"})})),j()(this,"handleMainInput",((e,t)=>{const{target:n}=e,{value:o,files:r}=n;this.setState((()=>{const e={current:!1};return t===ge?(e.val=o,e.current=""!==o.trim()&&ge):t===ve?(e.val=o,e.current="null"!==o&&ve):t===me&&(e.val=r[0],e.current=0!==r?.length&&me),e.current?{inputVals:e}:{inputVals:{current:!1}}}))})),j()(this,"rowClick",((e,t)=>{this.setState({selected:{...t,isSelected:!0}})})),j()(this,"delIcon",((e,{courseId:t})=>{e.stopImmediatePropagation(),fe(t),t===this.state.selected.courseId&&this.reset(),this.updateCourseById(t)})),j()(this,"updateCourseById",(e=>{this.setState((({courses:t})=>{for(const n of t)if(n.courseId===e){n.iconVals=Ce(e);break}return{courses:t}}))})),j()(this,"componentDidMount",(()=>{this.updateCourses()})),j()(this,"updateCourses",(()=>{$(!1,this.setState.bind(this)).then((e=>{const t=Object.entries(e).sort(((e,t)=>{const n=e[1].toLowerCase(),o=t[1].toLowerCase();return n<o?-1:n>o?1:0})).map((([e,t])=>({courseId:e,courseName:t,iconVals:Ce(e)})));this.setState({courses:t})}))})),j()(this,"reset",((e=!0)=>{this.form.current.reset(),this.setState({inputVals:{current:!1},...e&&{selected:{isSelected:!1}}})})),j()(this,"saveHandlers",{saveByURL:e=>{try{const t=new URL(e);GM_xmlhttpRequest({method:"GET",url:t.href,timeout:15e3,responseType:"blob",anonymous:!0,onabort:()=>{this.setState({notificationString:"Request was aborted"})},onerror:()=>{this.setState({notificationString:be})},ontimeout:()=>{this.setState({notificationString:"Request timed out"})},onload:e=>{var t,n;200===e.status?this.saveHandlers.saveWithFileHandler(e.response):this.setState({notificationString:(t=e.status,n=e.statusText,`Error ${t}: ${n}`)})}})}catch{this.setState({notificationString:"Invalid URL submitted"})}},saveWithFileHandler:e=>{const t=new FileReader;t.addEventListener("error",(()=>{this.setState({notificationString:be})})),t.addEventListener("load",(()=>{const n=new Image;n.addEventListener("error",(()=>{this.setState({notificationString:"File was not an image"})})),n.addEventListener("load",(()=>{const n=this.state.selected.courseId;fe(n);const o=GM_getValue("pointers"),r=Ve(),i=GM_getValue("values"),s={},{rawByteString:l}=t.result.match(/^data:[\w+/]+;base64,(?<rawByteString>.+)$/).groups;if("image/svg+xml"===e.type){const e=decodeURI(atob(l));s.rawXML=e}else s.rawByteString=l,s.mediaType=e.type;i[r]=s,GM_setValue("values",i),o[n]=r,GM_setValue("pointers",o),this.updateCourseById(n),this.reset()})),n.src=t.result})),t.readAsDataURL(e)},saveByCopy:e=>{const{courseId:t}=this.state.selected,n=GM_getValue("pointers");fe(t),n[t]=n[e],GM_setValue("pointers",n),this.updateCourseById(t),this.reset()}})}}const ke=({class:e,...t})=>u("svg",Z()({fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",class:"svg-icon svg-icon-x"+(e?` ${e}`:""),viewBox:"0 0 24 24"},t),u("path",{d:"M24 0L0 24M0 0l24 24"})),xe=({courses:e,...t})=>u("div",{class:"outer-sidebar"},u("div",{class:"sidebar"},0===e.length&&u("div",null,"Loading courses...."),e.map((e=>u(Se,Z()({key:e.courseId,item:e},t)))))),Se=({item:e,rowClick:t,delIcon:n})=>{const{courseName:o,iconVals:r}=e;return u("div",{class:"row",onClick:n=>{t(n,e)}},u(Me,{renderX:!0,iconVals:r,delIcon:t=>{n(t,e)}}),u("span",null,o))},Me=({iconVals:{hasIcon:e,isXML:t,rawXML:n,dataURI:o},delIcon:r,renderX:i=!1})=>e&&u(_,null,t?u("span",{class:"icon"},G([n])):u("img",{src:o,class:"icon"}),i&&u(ke,{class:"svg-del-icon",onClick:r})),Ce=e=>{const t=GM_getValue("pointers")[e];if(t){const e=GM_getValue("values")[t];if(e){const t={isXML:"rawXML"in e,hasIcon:!0};if(t.isXML)t.rawXML=e.rawXML;else{const{mediaType:n,rawByteString:o}=e;t.dataURI=`data:${n};base64,${o}`}return t}}return{hasIcon:!1}},Le=({selected:{iconVals:e,courseName:t,isSelected:n,courseId:o},courses:r,handleInput:i,currentInput:s,currentInputVal:l,handleSave:a,loggedOut:c,loggedOutCallback:d,formRef:p,reset:h})=>{const f=ae(null),m=ae(null),v=ae(null);return u("div",{class:"outer-main"},u("div",{class:"main"},c?u("div",{class:"replace-flex-input"},u("h2",null,"Login"),u("input",{placeholder:"Username",ref:m}),u("input",{placeholder:"Password",ref:v,type:"password"}),u("button",{class:"btn-save",type:"button",onClick:()=>{const e=m.current?.value?.trim(),t=v.current?.value;d({username:e,password:t})}},"Login")):u("form",{ref:p},u("h2",null,"Change or add an icon"),u("div",null,n?u(_,null,u(Me,{iconVals:e}),u("span",null,t)):"Select course to the left"),u("h3",null,"Upload image from URL"),u("input",{type:"url",placeholder:"Image url",disabled:s&&s!==ge,onInput:e=>{i(e,ge)}}),u("h3",null,"Upload image from file"),u("input",{type:"file",hidden:!0,ref:f,onInput:e=>{i(e,me)}}),u("button",{type:"button",onClick:()=>{f.current?.click()},disabled:s&&s!==me},s===me?u(_,null,l.name,u(ke,{class:"svg-clear",onClick:e=>{e.preventDefault(),e.stopImmediatePropagation(),h()}})):"Upload file"),u("h3",null,"Copy image from other course"),u("select",{disabled:s&&s!==ve,onInput:e=>{i(e,ve)}},u("option",{selected:!0,value:"null"},"Select course to copy icon from"),r.map((({courseName:e,courseId:t,iconVals:{hasIcon:r}})=>r&&(!n||o!==t)&&u("option",{value:t},e)))),u("button",{class:"btn-save",type:"button",onClick:a},"Save"))))},Ie=({handleClick:t,notificationString:n})=>(function(t,n){var o=le(Y++,3);!e.__s&&pe(o.__H,n)&&(o.__=()=>{scroll({top:0,left:0,behavior:"smooth"})},o.__H=n,J.__H.__h.push(o))}(0,[]),u("div",{class:"outer-notification",onClick:e=>{t(e,!0)}},u("div",{class:"inner-notification"},u(ke,{class:"svg-close",onClick:t}),u("div",{class:"notification-string"},n)))),Ve=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)));
// ==UserScript==
// @name      Custom Icons Preact
// @version   2021.02.22a
// @author    lusc
// @updateURL https://github.com/melusc/moodle_userscripts/raw/main/dist/Custom%20Icons/custom-icons.user.js
// @include   *://moodle.ksasz.ch/*
// @grant     GM_setValue
// @grant     GM_getValue
// @grant     GM_addStyle
// @grant     GM_deleteValue
// @grant     GM_addValueChangeListener
// @grant     GM_registerMenuCommand
// @grant     GM_xmlhttpRequest
// @run-at    document-start
// @connect   *
// ==/UserScript==
"object"!=typeof GM_getValue("pointers")&&(GM_setValue("pointers",{}),GM_setValue("values",{}));const Ue=!/^\/customiconspreact/i.test(location.pathname),Pe=()=>{GM_registerMenuCommand("Open settings",(()=>{open("/customIconsPreact/","_blank")})),addEventListener("customIconsPreact",Ee),Ee()},Ee=()=>{const e=He(document);if(e){const t=Object.keys(GM_getValue("pointers"));for(const n of t)Oe(n,e);GM_addValueChangeListener("pointers",Re)}},Oe=(e,t)=>{const n=t.querySelector(`a[href="https://moodle.ksasz.ch/course/view.php?id=${e}"]`);if(n){if(n.childElementCount>0){const t=Ge(e);if("object"!=typeof t)return;if(t.isXML){const e=document.createElement("span");e.className="icon navicon",e.style.display="inline-block",e.style.color="var(--svg-fill, inherit)",P(G([t.rawXML]),e),n.firstElementChild.replaceWith(e)}else{const e=new Image;e.classList.add("icon","navicon"),e.setAttribute("aria-hidden",!0),e.style="fill: var(--svg-fill, inherit);stroke: var(--svg-fill, inherit);-moz-context-properties: fill, stroke;",e.tabIndex=-1,e.src=t.blobURL,e.addEventListener("load",(()=>{URL.revokeObjectURL(t.blobURL)}),{once:!0}),n.firstElementChild.replaceWith(e)}}}else je(e)},Ge=e=>{const t=Te(e);if("object"==typeof t){if(t.isXML)return t;const{mediaType:e,rawByteString:n}=t,o=atob(n),{length:r}=o,i=new ArrayBuffer(r),s=new Uint8Array(i);for(let e=0;e<r;++e)s[e]=o.charCodeAt(e);const l=new Blob([s],{type:e});return{blobURL:URL.createObjectURL(l),isXML:!1}}},Re=(e,t,n,o)=>{if(o){const e=He(document),o=Object.entries(t),r=Object.entries(n).filter((([e,n])=>!(e in t)&&t[e]!==n)),i=o.filter((([e])=>!(e in n)));for(const[t]of i){const n=e.querySelector(`a[href="https://moodle.ksasz.ch/course/view.php?id=${t}"] > .icon.navicon`);if(n&&("SPAN"===n.nodeName||"IMG"===n.nodeName)){const e=document.createElement("i");e.classList.add("icon","fa","fa-graduation-cap","fa-fw","navicon"),e.setAttribute("aria-hidden",!0),e.tabIndex=-1,n.replaceWith(e)}}for(const[t]of r)Oe(t,e)}},je=e=>{$().then((t=>{e in t||(fe(e),alert(`You appear to not be in the course with the id "${e}" anymore.\nThe course will not be checked for anymore`))}))},He=e=>e.querySelector('li[aria-labelledby="label_2_4"] ul[role="group"]')??e.querySelector("#label_3_21")?.closest('ul[role="group"]'),Te=e=>{const t=GM_getValue("pointers")[e];if(!t)return;const n=GM_getValue("values")[t];return"rawXML"in n?{rawXML:n.rawXML,isXML:!0}:{...n,isXML:!1}};if(!/^\/cleanmoodle/i.test(location.pathname)){const e=Ue?Pe:ye;"complete"===document.readyState?e():addEventListener("DOMContentLoaded",e,{once:!0})}})()})();